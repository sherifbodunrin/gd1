<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boss Battle Game</title>
    <script src="https://cdn.jsdelivr.net/npm/konva@8.3.0/konva.min.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: black;
            color: white;
            font-family: Arial, sans-serif;
        }
        #intro {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 10;
        }
        #startButton {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }
        #container {
            display: none; /* Hide game container initially */
        }
    </style>
</head>
<body>
    <div id="intro">
        <h1>Boss Battle Game</h1>
        <p>Beat all the boss stages as they get stronger!</p>
        <button id="startButton">Start Game</button>
    </div>
    <div id="container"></div>

    <script>
        const stage = new Konva.Stage({
            container: 'container',
            width: window.innerWidth,
            height: window.innerHeight
        });
        const layer = new Konva.Layer();
        stage.add(layer);

        // Create background music using new Audio
        const music = new Audio('deepSpace.mp3'); // Path to your music file
        music.loop = true; // Loop the music
        music.volume = 0.5; // Adjust volume as needed

        // Add the background image
        const backgroundImageObj = new Image();
        backgroundImageObj.src = 'https://wallpapercave.com/wp/wp9288093.jpg'; // Replace with your background URL
        backgroundImageObj.onload = function () {
            const background = new Konva.Image({
                x: 0,
                y: 0,
                image: backgroundImageObj,
                width: stage.width(),
                height: stage.height()
            });
            layer.add(background);
            layer.batchDraw();

            // Load player, boss, and text after the background
            startGame();
        };

        function startGame() {
            document.getElementById('intro').style.display = 'none'; // Hide intro screen
            document.getElementById('container').style.display = 'block'; // Show game container
            music.play(); // Start background music

            // Player represented as a blue circle
            const playerImageObj = new Image();
            playerImageObj.src = 'https://i.pinimg.com/originals/cf/04/e4/cf04e4e031c7bbd277a74cf32a3a6362.png';
            playerImageObj.onload = function () {
                const player = new Konva.Image({
                    x: stage.width() / 2 - 30,
                    y: stage.height() - 80,
                    image: playerImageObj,
                    width: 60,
                    height: 60
                });
                layer.add(player);

                let playerHp = 100;
                const playerHpBar = new Konva.Rect({
                    x: player.x() - 30,
                    y: player.y() + 40,
                    width: playerHp,
                    height: 10,
                    fill: 'green'
                });
                layer.add(playerHpBar);

                let level = 1;
                let score = 0;
                let bossHp;
                let boss, bossHpBar;
                let isGameOver = false;
                let bossShootingInterval;

                function spawnNewBoss() {
                    const bossImages = [
                        'https://cdna.artstation.com/p/assets/images/images/006/503/674/original/william-robinson-gun-alien-firing-animation.gif?1499108623',
                        'https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/5d6611b0-74f3-4f32-b8f7-25f20e4f64aa/d8o8amy-0b47096c-f464-45c5-a768-60eb1eb2e236.png?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1cm46YXBwOjdlMGQxODg5ODIyNjQzNzNhNWYwZDQxNWVhMGQyNmUwIiwiaXNzIjoidXJuOmFwcDo3ZTBkMTg4OTgyMjY0MzczYTVmMGQ0MTVlYTBkMjZlMCIsIm9iaiI6W1t7InBhdGgiOiJcL2ZcLzVkNjYxMWIwLTc0ZjMtNGYzMi1iOGY3LTI1ZjIwZTRmNjRhYVwvZDhvOGFteS0wYjQ3MDk2Yy1mNDY0LTQ1YzUtYTc2OC02MGViMWViMmUyMzYucG5nIn1dXSwiYXVkIjpbInVybjpzZXJ2aWNlOmZpbGUuZG93bmxvYWQiXX0.AcUpr0zYHWAWss-7YJNZbtYNOg1ygOFHzAXQG36tqQ8',
                        'https://www.arcadequartermaster.com/mslug3/boss6.png',
                        'https://i.redd.it/9gvo2imxyxd81.gif'
                    ];
                    
                    const randomBossImage = bossImages[Math.floor(Math.random() * bossImages.length)];
                    
                    const bossImageObj = new Image();
                    bossImageObj.src = randomBossImage; 
                    bossImageObj.onload = function () {
                        boss = new Konva.Image({
                            x: stage.width() / 2 - 50,
                            y: 50,
                            image: bossImageObj,
                            width: 100,
                            height: 100
                        });
                        layer.add(boss);

                        bossHp = 100 + (level - 1) * 20;
                        bossHpBar = new Konva.Rect({
                            x: boss.x(),
                            y: boss.y() - 20,
                            width: bossHp,
                            height: 10,
                            fill: 'green'
                        });
                        layer.add(bossHpBar);

                        layer.batchDraw();
                    };
                }

                const levelText = new Konva.Text({
                    x: stage.width() / 2 - 50,
                    y: 10,
                    text: `Level ${level}`,
                    fontSize: 24,
                    fill: 'white'
                });
                layer.add(levelText);

                function updateBossHp(damage) {
                    if (isGameOver) return;
                    bossHp = Math.max(0, bossHp - damage);
                    bossHpBar.width(bossHp);
                    if (bossHp === 0) {
                        score += level * 10;
                        boss.destroy();
                        bossHpBar.destroy();
                        level++;
                        levelText.text(`Level ${level}`);

                        playerHp = Math.min(100, playerHp + 50);
                        playerHpBar.width(playerHp);

                        const sound1 = new Audio('level.mp3'); // Path to your music file
                        sound1.volume = 0.5; // Adjust volume as needed
                        sound1.play();
                        
                        spawnNewBoss();
                        clearInterval(bossShootingInterval);
                        setRandomBossShootingPattern();
                    }
                    layer.batchDraw();
                }

                function updatePlayerHp(damage) {
                    if (isGameOver) return;
                    playerHp = Math.max(0, playerHp - damage);
                    playerHpBar.width(playerHp);
                    if (playerHp === 0) {
                        const gameOverOverlay = new Konva.Rect({
                            x: 0,
                            y: 0,
                            width: stage.width(),
                            height: stage.height(),
                            fill: 'black',
                            opacity: 0.8
                        });
                        layer.add(gameOverOverlay);

                        const highestLevelText = new Konva.Text({
                            x: stage.width() / 2 - 150,
                            y: stage.height() / 2 - 50,
                            text: 'Game Over! Your highest level: ' + level,
                            fontSize: 36,
                            fill: 'white'
                        });
                        layer.add(highestLevelText);

                        layer.batchDraw();
                        clearInterval(bossShootingInterval);
                        isGameOver = true;
                    }
                    layer.batchDraw();
                }

                function shootBullet() {
                    if (isGameOver) return;
                    const bullet = new Konva.Circle({
                        x: player.x() + player.width() / 2,
                        y: player.y() - 30,
                        radius: 5,
                        fill: 'lime'
                    });
                    layer.add(bullet);
                    bullet.hasDamagedBoss = false;

                    const sound2 = new Audio('shoot.mp3'); // Path to your music file
                    sound2.volume = 0.5; // Adjust volume as needed
                    sound2.play();
                    
                    const bulletAnimation = new Konva.Animation(function (frame) {
                        bullet.y(bullet.y() - 5);
                        if (bullet.y() < 0) {
                            bullet.destroy();
                            layer.batchDraw();
                            bulletAnimation.stop();
                        } else if (boss && !bullet.hasDamagedBoss && bullet.x() > boss.x() && bullet.x() < boss.x() + boss.width() && bullet.y() < boss.y() + boss.height() && bullet.y() > boss.y()) {
                            bullet.hasDamagedBoss = true;
                            updateBossHp(20);
                        }
                    }, layer);
                    bulletAnimation.start();
                }

                function setRandomBossShootingPattern() {
                    const patterns = [
                        function () {
                            // Pattern 1: Random shooting
                            bossShootingInterval = setInterval(function () {
                                if (isGameOver) return;
                                const bullet = new Konva.Circle({
                                    x: boss.x() + boss.width() / 2,
                                    y: boss.y() + boss.height(),
                                    radius: 8,
                                    fill: 'red'
                                });
                                layer.add(bullet);

                                const bulletAnimation = new Konva.Animation(function (frame) {
                                    bullet.y(bullet.y() + 4);
                                    if (bullet.y() > stage.height()) {
                                        bullet.destroy();
                                        layer.batchDraw();
                                        bulletAnimation.stop();
                                    } else if (bullet.x > player.x() && bullet.x < player.x() + player.width() && bullet.y > player.y() && bullet.y < player.y() + player.height()) {
                                        updatePlayerHp(20);
                                        bullet.destroy();
                                        layer.batchDraw();
                                        bulletAnimation.stop();
                                    }
                                }, layer);
                                bulletAnimation.start();
                            }, 1000);
                        },
                        function () {
                            // Pattern 2: Targeted shooting
                            bossShootingInterval = setInterval(function () {
                                if (isGameOver) return;
                                const bullet = new Konva.Circle({
                                    x: boss.x() + boss.width() / 2,
                                    y: boss.y() + boss.height(),
                                    radius: 8,
                                    fill: 'red'
                                });
                                layer.add(bullet);

                                const targetX = player.x() + player.width() / 2;
                                const bulletAnimation = new Konva.Animation(function (frame) {
                                    const direction = targetX > bullet.x() ? 2 : -2;
                                    bullet.x(bullet.x() + direction);
                                    bullet.y(bullet.y() + 4);
                                    if (bullet.y() > stage.height()) {
                                        bullet.destroy();
                                        layer.batchDraw();
                                        bulletAnimation.stop();
                                    } else if (bullet.x > player.x() && bullet.x < player.x() + player.width() && bullet.y > player.y() && bullet.y < player.y() + player.height()) {
                                        updatePlayerHp(20);
                                        bullet.destroy();
                                        layer.batchDraw();
                                        bulletAnimation.stop();
                                    }
                                }, layer);
                                bulletAnimation.start();
                            }, 1500);
                        }
                    ];
                    const randomPattern = patterns[Math.floor(Math.random() * patterns.length)];
                    randomPattern();
                }

                window.addEventListener('keydown', function (e) {
                    if (isGameOver) return;
                    if (e.key === ' ') {
                        shootBullet();
                    }
                });

                spawnNewBoss();
            };
        }
        
        document.getElementById('startButton').onclick = function () {
            startGame();
        };
    </script>
</body>
</html>
