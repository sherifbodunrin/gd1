<script src="https://cdn.jsdelivr.net/npm/konva@8.3.0/konva.min.js"></script>
<div id="container"></div>
<script>
  const stage = new Konva.Stage({
    container: 'container',
    width: window.innerWidth,
    height: window.innerHeight
  });
  const layer = new Konva.Layer();
  stage.add(layer);

  // Player represented as a blue circle
  const player = new Konva.Circle({
    x: stage.width() / 2,
    y: stage.height() - 50,
    radius: 30,
    fill: 'blue'
  });
  layer.add(player);

  // Bullet shooting function
  function shootBullet() {
    const bullet = new Konva.Circle({
      x: player.x(),
      y: player.y() - 30,
      radius: 5,
      fill: 'red'
    });
    layer.add(bullet);

    // Bullet movement animation
    const anim = new Konva.Animation(() => {
      bullet.y(bullet.y() - 10);
      if (bullet.y() < 0) bullet.destroy();
    }, layer);
    anim.start();
  }

  // Event listener for space bar to shoot bullets
  window.addEventListener('keydown', (e) => {
    if (e.key === ' ') {
      shootBullet();
    }
  });

  // Enemy creation function
  function createEnemy() {
    const enemy = new Konva.Circle({
      x: Math.random() * stage.width(),
      y: -20, // Start just above the top
      radius: 20,
      fill: 'green'
    });
    layer.add(enemy);

    const anim = new Konva.Animation(() => {
      enemy.y(enemy.y() + 2); // Enemy falls down
      if (enemy.y() > stage.height()) {
        enemy.destroy(); // Remove enemy once it falls off the screen
      }
    }, layer);
    anim.start();
  }

  // Generate enemies at intervals, but not too many
  let enemyCount = 0;
  const maxEnemies = 5;
  setInterval(() => {
    if (enemyCount < maxEnemies) {
      createEnemy();
      enemyCount++;
    }
  }, 2000); // New enemy every 2 seconds

  // Redraw the layer
  layer.draw();
</script>
