<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boss Battle Game</title>
    <script src="https://cdn.jsdelivr.net/npm/konva@8.3.0/konva.min.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <div id="container"></div>
    <script>
        const stage = new Konva.Stage({
            container: 'container',
            width: window.innerWidth,
            height: window.innerHeight
        });
        const layer = new Konva.Layer();
        stage.add(layer);

        // Load the player image (spaceship)
        const spaceshipImage = new Image();
        spaceshipImage.src = 'https://e7.pngegg.com/pngimages/861/595/png-clipart-spaceshiptwo-spacecraft-sprite-spaceshipone-sprite-spacecraft-symmetry.png';
        
        spaceshipImage.onload = function() {
            const player = new Konva.Image({
                x: stage.width() / 2 - 30, // Adjust to center
                y: stage.height() - 100,   // Adjust to be near the bottom
                image: spaceshipImage,
                width: 60,
                height: 60
            });
            layer.add(player);
            layer.batchDraw();

            // Initialize level and score
            let level = 1;
            let score = 0;
            let playerBulletDamage = 2; // Initial bullet damage

            // Player HP Bar (below the player)
            let playerHp = 100;
            const playerHpBar = new Konva.Rect({
                x: player.x() - 30,
                y: player.y() + 60, // Position below the player
                width: playerHp, // Player HP starts at 100
                height: 10,
                fill: 'green'
            });
            layer.add(playerHpBar);

            // Game over flag
            let isGameOver = false;

            // Player movement and HP update logic remains unchanged
            function updatePlayerHp(damage) {
                if (isGameOver) return;
                playerHp = Math.max(0, playerHp - damage);
                playerHpBar.width(playerHp);
                if (playerHp === 0) {
                    console.log('Player defeated! Game Over! Your score: ' + score);
                    isGameOver = true;
                    clearInterval(bossShootingInterval);
                }
                layer.batchDraw();
            }

            const keysPressed = {};
            window.addEventListener('keydown', (e) => {
                keysPressed[e.key] = true;
                if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', ' '].includes(e.key)) {
                    e.preventDefault();
                }
                if (e.key === ' ' && !isGameOver) {
                    shootBullet();
                }
            });

            window.addEventListener('keyup', (e) => {
                keysPressed[e.key] = false;
            });

            function movePlayer() {
                if (isGameOver) return;
                if (keysPressed['ArrowLeft']) {
                    player.x(player.x() - 5);
                    playerHpBar.x(player.x() - 30);
                }
                if (keysPressed['ArrowRight']) {
                    player.x(player.x() + 5);
                    playerHpBar.x(player.x() - 30);
                }
                if (keysPressed['ArrowUp']) {
                    player.y(player.y() - 5);
                    playerHpBar.y(player.y() + 60);
                }
                if (keysPressed['ArrowDown']) {
                    player.y(player.y() + 5);
                    playerHpBar.y(player.y() + 60);
                }

                if (player.x() < 0) player.x(0);
                if (player.x() > stage.width() - 60) player.x(stage.width() - 60); // Adjust for image width
                if (player.y() < 0) player.y(0);
                if (player.y() > stage.height() - 60) player.y(stage.height() - 60); // Adjust for image height

                layer.batchDraw();
            }

            function animate() {
                movePlayer();
                requestAnimationFrame(animate);
            }
            animate();
        };

        // Other game logic such as boss spawning, shooting, etc. remains unchanged
        // ...

    </script>
</body>
</html>
