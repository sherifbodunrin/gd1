<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boss Battle Game</title>
    <script src="https://cdn.jsdelivr.net/npm/konva@8.3.0/konva.min.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <div id="container"></div>
    <script>
        const stage = new Konva.Stage({
            container: 'container',
            width: window.innerWidth,
            height: window.innerHeight
        });
        const layer = new Konva.Layer();
        stage.add(layer);

        // Load player image
        const playerImageObj = new Image();
        playerImageObj.src = 'https://path/to/your/player-image.png'; // Replace with your image URL

        let player;
        playerImageObj.onload = function() {
            // Replace player circle with an image
            player = new Konva.Image({
                x: stage.width() / 2 - 30, // Center the player
                y: stage.height() - 80,    // Position near the bottom
                image: playerImageObj,
                width: 60,  // Adjust size as needed
                height: 60
            });
            layer.add(player);

            // Player HP Bar (below the player)
            let playerHp = 100;
            const playerHpBar = new Konva.Rect({
                x: player.x(),
                y: player.y() + 60, // Position below the player
                width: playerHp,    // Player HP starts at 100
                height: 10,
                fill: 'green'
            });
            layer.add(playerHpBar);

            // Continue with your game logic here...

            // Update movement to keep HP bar aligned with player
            function movePlayer() {
                if (isGameOver) return;
                if (keysPressed['ArrowLeft']) {
                    player.x(player.x() - 5);
                    playerHpBar.x(player.x());
                }
                if (keysPressed['ArrowRight']) {
                    player.x(player.x() + 5);
                    playerHpBar.x(player.x());
                }
                if (keysPressed['ArrowUp']) {
                    player.y(player.y() - 5);
                    playerHpBar.y(player.y() + 60);
                }
                if (keysPressed['ArrowDown']) {
                    player.y(player.y() + 5);
                    playerHpBar.y(player.y() + 60);
                }

                // Boundaries to prevent the player from going off-screen
                if (player.x() < 0) player.x(0);
                if (player.x() > stage.width() - player.width()) player.x(stage.width() - player.width());
                if (player.y() < 0) player.y(0);
                if (player.y() > stage.height() - player.height()) player.y(stage.height() - player.height());

                layer.batchDraw();
            }

            // Start the animation loop as usual
            animate();
        };

        // Initialize level, score, and other variables here...

        // Game over flag
        let isGameOver = false;

        // Smoother arrow key movement with disabling default behavior
        const keysPressed = {};

        window.addEventListener('keydown', (e) => {
            keysPressed[e.key] = true;
            if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', ' '].includes(e.key)) {
                e.preventDefault();
            }
            // Event listener for space bar to shoot bullets
            if (e.key === ' ' && !isGameOver) {
                shootBullet();
            }
        });

        window.addEventListener('keyup', (e) => {
            keysPressed[e.key] = false;
        });

        // Boss shooting function and other functions remain the same...

        function animate() {
            movePlayer();
            requestAnimationFrame(animate);
        }

        animate(); // Start the animation loop

    </script>
</body>
</html>
