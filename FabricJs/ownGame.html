<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boss Battle Game</title>
    <script src="https://cdn.jsdelivr.net/npm/konva@8.3.0/konva.min.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <div id="container"></div>

    <script>
        const stage = new Konva.Stage({
            container: 'container',
            width: window.innerWidth,
            height: window.innerHeight
        });
        const layer = new Konva.Layer();
        stage.add(layer);

        const music = new Audio('deepSpace.mp3');
        music.loop = true;
        music.volume = 0.5;
        music.play();

        const backgroundImageObj = new Image();
        backgroundImageObj.src = 'https://wallpapercave.com/wp/wp9288093.jpg';
        backgroundImageObj.onload = function () {
            const background = new Konva.Image({
                x: 0,
                y: 0,
                image: backgroundImageObj,
                width: stage.width(),
                height: stage.height()
            });
            layer.add(background);
            layer.batchDraw();
            startGame();
        };

        function startGame() {
            const playerImageObj = new Image();
            playerImageObj.src = 'https://i.pinimg.com/originals/cf/04/e4/cf04e4e031c7bbd277a74cf32a3a6362.png';
            playerImageObj.onload = function () {
                const player = new Konva.Image({
                    x: stage.width() / 2 - 30,
                    y: stage.height() - 80,
                    image: playerImageObj,
                    width: 60,
                    height: 60
                });
                layer.add(player);

                let playerHp = 100;
                const playerHpBar = new Konva.Rect({
                    x: player.x() - 30,
                    y: player.y() + 40,
                    width: playerHp,
                    height: 10,
                    fill: 'green'
                });
                layer.add(playerHpBar);

                let level = 1;
                let score = 0;
                let bossesDefeated = 0;
                let totalBosses = 1;
                let isGameOver = false;
                let bosses = [];
                let bossHpBars = [];
                const speed = 3;
                let bossMovementInterval;

                // Timer setup
                let timeLeft = 15;
                const timerText = new Konva.Text({
                    x: stage.width() - 100,
                    y: 10,
                    text: `Time: ${timeLeft}`,
                    fontSize: 24,
                    fill: 'white'
                });
                layer.add(timerText);

                function updateTimer() {
                    const timerInterval = setInterval(() => {
                        if (isGameOver) {
                            clearInterval(timerInterval);
                            return;
                        }

                        timeLeft--;
                        timerText.text(`Time: ${timeLeft}`);
                        playerHp = Math.max(0, playerHp - 5); // Lose health as timer counts down
                        playerHpBar.width(playerHp);

                        if (timeLeft <= 0) {
                            clearInterval(timerInterval);
                            updatePlayerHp(playerHp); // Check if player is out of health
                            resetTimer();
                        }

                        if (playerHp <= 0) {
                            triggerGameOver();
                        }

                        layer.batchDraw();
                    }, 1000);
                }

                function resetTimer() {
                    timeLeft = 15;
                    timerText.text(`Time: ${timeLeft}`);
                    layer.batchDraw();
                }

                function spawnNewBosses() {
                    bosses = [];
                    bossHpBars = [];

                    for (let i = 0; i < totalBosses; i++) {
                        const bossImageObj = new Image();
                        bossImageObj.src = 'https://www.kindpng.com/picc/m/451-4517876_pixel-art-boss-hd-png-download.png';
                        bossImageObj.onload = function () {
                            const boss = new Konva.Image({
                                x: Math.random() * (stage.width() - 60),
                                y: 50,
                                image: bossImageObj,
                                width: 60,
                                height: 60
                            });
                            layer.add(boss);
                            bosses.push(boss);

                            let bossHp = 100;
                            const bossHpBar = new Konva.Rect({
                                x: boss.x(),
                                y: boss.y() - 10,
                                width: bossHp,
                                height: 10,
                                fill: 'red'
                            });
                            layer.add(bossHpBar);
                            bossHpBars.push(bossHpBar);
                        };
                    }

                    layer.batchDraw();
                    moveBoss();
                    updateTimer(); // Start/restart timer with each level
                }

                function triggerGameOver() {
                    const gameOverOverlay = new Konva.Rect({
                        x: 0,
                        y: 0,
                        width: stage.width(),
                        height: stage.height(),
                        fill: 'black',
                        opacity: 0.8
                    });
                    layer.add(gameOverOverlay);

                    const highestLevelText = new Konva.Text({
                        x: stage.width() / 2 - 150,
                        y: stage.height() / 2 - 50,
                        text: 'Game Over! Your highest level: ' + level,
                        fontSize: 36,
                        fill: 'white'
                    });
                    layer.add(highestLevelText);
                    layer.batchDraw();
                    isGameOver = true;
                }

                function updatePlayerHp(damage) {
    if (isGameOver) return;
    playerHp = Math.max(0, playerHp - (damage * 1.5)); // Increased damage multiplier
    playerHpBar.width(playerHp);
    if (playerHp === 0) {
        const gameOverOverlay = new Konva.Rect({
            x: 0,
            y: 0,
            width: stage.width(),
            height: stage.height(),
            fill: 'black',
            opacity: 0.8
        });
        layer.add(gameOverOverlay);

        const highestLevelText = new Konva.Text({
            x: stage.width() / 2 - 150,
            y: stage.height() / 2 - 50,
            text: 'Game Over! Your highest level: ' + level,
            fontSize: 36,
            fill: 'white'
        });
        layer.add(highestLevelText);
        layer.batchDraw();
        isGameOver = true;
    }
    layer.batchDraw();
}


                function moveBoss() {
                    bossMovementInterval = setInterval(() => {
                        if (isGameOver) {
                            clearInterval(bossMovementInterval);
                            return;
                        }

                        bosses.forEach((boss, index) => {
                            const dy = Math.random() * speed;
                            boss.y(boss.y() + dy);
                            bossHpBars[index].y(boss.y() - 10);

                            if (boss.y() > stage.height()) {
                                boss.y(50);
                                boss.x(Math.random() * (stage.width() - 60));
                            }
                        });

                        layer.batchDraw();
                    }, 100);
                }

                function shoot() {
                    const bullet = new Konva.Rect({
                        x: player.x() + player.width() / 2 - 2.5,
                        y: player.y() - 10,
                        width: 5,
                        height: 10,
                        fill: 'yellow'
                    });
                    layer.add(bullet);

                    const bulletInterval = setInterval(() => {
                        if (isGameOver) {
                            bullet.destroy();
                            clearInterval(bulletInterval);
                            return;
                        }

                        bullet.y(bullet.y() - 5);

                        bosses.forEach((boss, index) => {
                            if (bullet.getClientRect().intersects(boss.getClientRect())) {
                                bullet.destroy();
                                clearInterval(bulletInterval);

                                bossHpBars[index].width(bossHpBars[index].width() - 20);

                                if (bossHpBars[index].width() <= 0) {
                                    boss.destroy();
                                    bossHpBars[index].destroy();
                                    bosses.splice(index, 1);
                                    bossHpBars.splice(index, 1);
                                    bossesDefeated++;
                                    score += 10;

                                    if (bossesDefeated >= totalBosses) {
                                        level++;
                                        totalBosses++;
                                        resetTimer();
                                        spawnNewBosses();
                                    }
                                }
                            }
                        });

                        if (bullet.y() < 0) {
                            bullet.destroy();
                            clearInterval(bulletInterval);
                        }

                        layer.batchDraw();
                    }, 20);
                }

                document.addEventListener('keydown', (e) => {
                    if (isGameOver) return;

                    if (e.key === 'ArrowLeft') {
                        player.x(Math.max(0, player.x() - 10));
                        playerHpBar.x(player.x() - 30);
                    } else if (e.key === 'ArrowRight') {
                        player.x(Math.min(stage.width() - player.width(), player.x() + 10));
                        playerHpBar.x(player.x() - 30);
                    } else if (e.key === ' ') {
                        shoot();
                    }

                    layer.batchDraw();
                });

                spawnNewBosses();
            };
        }
    </script>
</body>
</html>
