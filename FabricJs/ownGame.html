<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boss Battle Game</title>
    <script src="https://cdn.jsdelivr.net/npm/konva@8.3.0/konva.min.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <div id="container"></div>

    <script>
        const stage = new Konva.Stage({
            container: 'container',
            width: window.innerWidth,
            height: window.innerHeight
        });
        const layer = new Konva.Layer();
        stage.add(layer);

        const backgroundImageObj = new Image();
        backgroundImageObj.src = 'https://wallpapercave.com/wp/wp9288093.jpg';
        backgroundImageObj.onload = function () {
            const background = new Konva.Image({
                x: 0,
                y: 0,
                image: backgroundImageObj,
                width: stage.width(),
                height: stage.height()
            });
            layer.add(background);
            layer.batchDraw();
            startGame();
        };

        function startGame() {
            const playerImageObj = new Image();
            playerImageObj.src = 'https://i.pinimg.com/originals/cf/04/e4/cf04e4e031c7bbd277a74cf32a3a6362.png';
            playerImageObj.onload = function () {
                const player = new Konva.Image({
                    x: stage.width() / 2 - 30,
                    y: stage.height() - 80,
                    image: playerImageObj,
                    width: 60,
                    height: 60
                });
                layer.add(player);

                const bosses = [];
                let isGameOver = false;

                function spawnNewBosses() {
                    const bossImages = [
                        'https://cdna.artstation.com/p/assets/images/images/006/503/674/original/william-robinson-gun-alien-firing-animation.gif?1499108623'
                    ];

                    const bossImageObj = new Image();
                    bossImageObj.src = bossImages[0];

                    bossImageObj.onload = function () {
                        const boss = new Konva.Image({
                            x: Math.random() * (stage.width() - 100),
                            y: Math.random() * (stage.height() / 2),
                            image: bossImageObj,
                            width: 100,
                            height: 100
                        });

                        layer.add(boss);
                        bosses.push(boss);

                        shootAtPlayer(boss);  // Boss starts shooting at the player
                    };
                }

                function shootAtPlayer(boss) {
                    const shootInterval = setInterval(() => {
                        if (isGameOver) {
                            clearInterval(shootInterval);
                            return;
                        }

                        const bulletImageObj = new Image();
                        bulletImageObj.src = 'https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/a23b539f-36f1-4675-8f36-64dda35ea03e/dhfsc7z-89a47d9f-68d0-4c81-a224-4dc0bc5688a3.png';

                        bulletImageObj.onload = function () {
                            const bullet = new Konva.Image({
                                x: boss.x() + boss.width() / 2 - 10,
                                y: boss.y() + boss.height(),
                                image: bulletImageObj,
                                width: 20,
                                height: 20
                            });
                            layer.add(bullet);

                            const dx = player.x() + player.width() / 2 - bullet.x();
                            const dy = player.y() - bullet.y();
                            const angle = Math.atan2(dy, dx);

                            const bulletSpeed = 2;
                            const anim = new Konva.Animation(() => {
                                bullet.x(bullet.x() + Math.cos(angle) * bulletSpeed);
                                bullet.y(bullet.y() + Math.sin(angle) * bulletSpeed);

                                if (
                                    bullet.y() < player.y() + player.height() &&
                                    bullet.y() > player.y() &&
                                    bullet.x() > player.x() &&
                                    bullet.x() < player.x() + player.width()
                                ) {
                                    // Handle collision with player
                                    bullet.destroy();
                                }

                                if (bullet.y() < 0 || bullet.y() > stage.height() || bullet.x() < 0 || bullet.x() > stage.width()) {
                                    bullet.destroy();
                                }
                            }, layer);
                            anim.start();
                        };
                    }, Math.random() * 800 + 300);
                }

                spawnNewBosses();
            };
        }
    </script>
</body>
</html>
