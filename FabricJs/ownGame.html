<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boss Battle Game</title>
    <script src="https://cdn.jsdelivr.net/npm/konva@8.3.0/konva.min.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <div id="container"></div>

    <script>
        const stage = new Konva.Stage({
            container: 'container',
            width: window.innerWidth,
            height: window.innerHeight
        });
        const layer = new Konva.Layer();
        stage.add(layer);

        // Start background music
        const music = new Audio('deepSpace.mp3');
        music.loop = true;
        music.volume = 0.5;
        music.play();

        // Add background image
        const backgroundImageObj = new Image();
        backgroundImageObj.src = 'https://wallpapercave.com/wp/wp9288093.jpg';
        backgroundImageObj.onload = function () {
            const background = new Konva.Image({
                x: 0,
                y: 0,
                image: backgroundImageObj,
                width: stage.width(),
                height: stage.height()
            });
            layer.add(background);
            layer.batchDraw();
            startGame();
        };

        function startGame() {
            const playerImageObj = new Image();
            playerImageObj.src = 'https://i.pinimg.com/originals/cf/04/e4/cf04e4e031c7bbd277a74cf32a3a6362.png';
            playerImageObj.onload = function () {
                const player = new Konva.Image({
                    x: stage.width() / 2 - 30,
                    y: stage.height() - 80,
                    image: playerImageObj,
                    width: 60,
                    height: 60
                });
                layer.add(player);

                let playerHp = 100;
                const playerHpBar = new Konva.Rect({
                    x: player.x() - 30,
                    y: player.y() + 40,
                    width: playerHp,
                    height: 10,
                    fill: 'green'
                });
                layer.add(playerHpBar);

                let level = 1;
                let score = 0;
                let bossesDefeated = 0;
                let totalBosses = 1; // Start with one boss
                let isGameOver = false;
                let bosses = [];
                let bossHpBars = [];
                let bossMovementInterval;
                const baseSpeed = 1; // Normal boss speed
                let timeLeft = 30; // 30-second time limit

                // Display timer
                const timerText = new Konva.Text({
                    x: 20,
                    y: 10,
                    text: `Time Left: ${timeLeft}`,
                    fontSize: 24,
                    fill: 'white'
                });
                layer.add(timerText);

                // Countdown timer
                const countdownInterval = setInterval(() => {
                    if (isGameOver) return;
                    timeLeft -= 1;
                    timerText.text(`Time Left: ${timeLeft}`);
                    if (timeLeft <= 0) {
                        gameOver();
                    }
                    layer.batchDraw();
                }, 1000);

                // Gradually decrease player's health over time
                const healthDecreaseInterval = setInterval(() => {
                    if (isGameOver) return;
                    updatePlayerHp(1); // Decrease health by 1 each second
                }, 1000);

                function gameOver() {
                    clearInterval(countdownInterval);
                    clearInterval(healthDecreaseInterval);
                    isGameOver = true;

                    const gameOverOverlay = new Konva.Rect({
                        x: 0,
                        y: 0,
                        width: stage.width(),
                        height: stage.height(),
                        fill: 'black',
                        opacity: 0.8
                    });
                    layer.add(gameOverOverlay);

                    const gameOverText = new Konva.Text({
                        x: stage.width() / 2 - 150,
                        y: stage.height() / 2 - 50,
                        text: 'Game Over! Time Up!',
                        fontSize: 36,
                        fill: 'white'
                    });
                    layer.add(gameOverText);
                    layer.batchDraw();
                }

                // Increase boss speed to make them extremely fast
                const speedMultiplier = 5;
                function moveBoss() {
                    if (bossMovementInterval) {
                        clearInterval(bossMovementInterval);
                    }

                    bossMovementInterval = setInterval(() => {
                        if (isGameOver) {
                            clearInterval(bossMovementInterval);
                            return;
                        }

                        bosses.forEach((boss, index) => {
                            if (!boss) return;

                            if (Math.random() < 0.01) {
                                boss.direction = Math.random() * Math.PI * 2;
                            }

                            const dx = Math.cos(boss.direction) * baseSpeed * speedMultiplier;
                            const dy = Math.sin(boss.direction) * baseSpeed * speedMultiplier;

                            boss.node.x(boss.node.x() + dx);
                            boss.node.y(boss.node.y() + dy);

                            if (boss.node.x() <= 0 || boss.node.x() + boss.node.width() >= stage.width()) {
                                boss.direction = Math.PI - boss.direction;
                            }
                            if (boss.node.y() <= 0 || boss.node.y() + boss.node.height() >= stage.height()) {
                                boss.direction = -boss.direction;
                            }

                            bossHpBars[index].x(boss.node.x());
                            bossHpBars[index].y(boss.node.y() - 20);
                        });

                        layer.batchDraw();
                    }, 1000 / 60);
                }

                function updatePlayerHp(damage) {
                    if (isGameOver) return;
                    playerHp = Math.max(0, playerHp - damage);
                    playerHpBar.width(playerHp);
                    if (playerHp === 0) {
                        gameOver();
                    }
                    layer.batchDraw();
                }

                spawnNewBosses();
            };
        }
    </script>
</body>
</html>
